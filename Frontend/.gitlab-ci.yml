.frontend_template: &frontend_configuration
  image: node:17-alpine
  before_script:
    - cd Frontend
    - npm ci --cache .npm --prefer-offline
  cache:
    key:
      files:
        - package-lock.json
    paths:
      - .npm/

frontend_build:
  <<: *frontend_configuration
  stage: build
  script:
    - npm run build

frontend_lint:
  <<: *frontend_configuration
  stage: verify
  script:
    - npm run lint

lhci:
  <<: *frontend_configuration
  image: cypress/browsers:node17.8.0-chrome99-ff97-slim
  stage: verify
  script:
    - npm run build
    - npx @lhci/cli@0.9.0 autorun --upload.target=temporary-public-storage --collect.settings.chromeFlags="--no-sandbox"

qodana-js:
  <<: *frontend_configuration
  image:
    name: jetbrains/qodana-js:2021.3-eap
    entrypoint: ['']
  stage: verify
  script:
    - /opt/idea/bin/entrypoint --results-dir=$CI_PROJECT_DIR/qodana --save-report --report-dir=$CI_PROJECT_DIR/qodana/report
  artifacts:
    paths:
      - qodana/report/
    expose_as: 'Qodana JS Report'
